# This workflow will run tests using node and then publish a package to GitHub Packages when a release is created
# For more information see: https://docs.github.com/en/actions/publishing-packages/publishing-nodejs-packages

name: Node.js Package

on:
  release:
    types: [created]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
      - run: npm ci
      - run: npm test

  publish-npm:
    needs: build
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: 20
          registry-url: https://registry.npmjs.org/
      - run: npm ci
      - run: npm publish
        env:
          NODE_AUTH_TOKEN: eyJub2lzZUtleSI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiQ0g2by9RRWZscWVnUTk2QWFaUGVkWEpjdGRzUjcyZkNld0c0TU9pSVVIMD0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiaTE2RGxmdWJYeE1LalhZOWY2U2o3cU44WHQyTm1TN2JlMWpoVFdOYmxUND0ifX0sInBhaXJpbmdFcGhlbWVyYWxLZXlQYWlyIjp7InByaXZhdGUiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJ5SHVaZFJRYjZSVzdNbGExN3BHMXNpRXM0Y3ZoNE55VjhyaGVDcXVFL0VRPSJ9LCJwdWJsaWMiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJSMVlxZjBMaWN6UUx3aHVqRCsxenNsSFRNRTduOWhsL2JJc08rWnFKT3cwPSJ9fSwic2lnbmVkSWRlbnRpdHlLZXkiOnsicHJpdmF0ZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6InVIYmJVYlhld1U2RnpwTkJrejk2SlJBQmFIQ252ZFpKMXpFMTdkQTFmV2s9In0sInB1YmxpYyI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6IkJ5d29IQ3RXT0FweFVIVGpPNEkzZE91Y0p5eDFvbnljRG0xYnZ0Qm9wZ3c9In19LCJzaWduZWRQcmVLZXkiOnsia2V5UGFpciI6eyJwcml2YXRlIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoidUxaWWpGU2l5cHMrNDkxU2VSOHRRSG1tZVFpKzJTVWQ5MDJrbUdrK2gyWT0ifSwicHVibGljIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiTTltS3JkVFBMMHk4MWgzeDZlNXdYSHhYUnkvVGlBNDZjNVlOVlVuNHVWdz0ifX0sInNpZ25hdHVyZSI6eyJ0eXBlIjoiQnVmZmVyIiwiZGF0YSI6Imp3TWFrVHQ2MCs2SjhzOHovb0xLY01jeHF1d3RTbTdIK0dpdXp0dVR4NlZOSG1sbktkQjNKTWNBRDBSR2pqQWNCZXE2WG5CQXNlbnIwcWN0YzBNZkJRPT0ifSwia2V5SWQiOjF9LCJyZWdpc3RyYXRpb25JZCI6MTUzLCJhZHZTZWNyZXRLZXkiOiJDeHBtalFOQWkyR1lUbkFuUXpJbnRncHhsVHFTVEJ1alBBelZHSFRXKzFJPSIsInByb2Nlc3NlZEhpc3RvcnlNZXNzYWdlcyI6W10sIm5leHRQcmVLZXlJZCI6MzEsImZpcnN0VW51cGxvYWRlZFByZUtleUlkIjozMSwiYWNjb3VudFN5bmNDb3VudGVyIjowLCJhY2NvdW50U2V0dGluZ3MiOnsidW5hcmNoaXZlQ2hhdHMiOmZhbHNlfSwiZGV2aWNlSWQiOiI3dUhTT3I3dVFPdVo5Zm5jcGhqbmlnIiwicGhvbmVJZCI6IjM0MThjNDIzLWUzYjgtNDNiZi05YWQxLTMzOTdlMjVjZDRiYyIsImlkZW50aXR5SWQiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJTZ09PM3VJOG5qYzl6elB1ZmQwRTBReW8zSHc9In0sInJlZ2lzdGVyZWQiOnRydWUsImJhY2t1cFRva2VuIjp7InR5cGUiOiJCdWZmZXIiLCJkYXRhIjoiMFNTWlJrTUMrbkk2R1lOTFd3VDYrQ0xRN1M4PSJ9LCJyZWdpc3RyYXRpb24iOnt9LCJwYWlyaW5nQ29kZSI6IjNBVlJWTjRRIiwibWUiOnsiaWQiOiIyNjM3Nzg4NTgyNDY6MjRAcy53aGF0c2FwcC5uZXQiLCJuYW1lIjoiwqLQvc6x0ZUtwqLPg+KIgtGUIn0sImFjY291bnQiOnsiZGV0YWlscyI6IkNKdlpqYkFFRU1EcnFic0dHQVVnQUNnQSIsImFjY291bnRTaWduYXR1cmVLZXkiOiJvYzgvU21KT0lMSGxzNkdYVzlzd3NZNUxGaExJVXlZb204dUJ5Ti96L2g4PSIsImFjY291bnRTaWduYXR1cmUiOiI4MnRzSTlpbENkVEo1NjkwcnJQcENDOEpvNFFnZ2NrRVB3K1VCZEtBNWZLckprR0cwV2NMejMwV25VZlZWa0NVWGxwZjl1Zk84VnQ0Q0p1ajk1Y1NBQT09IiwiZGV2aWNlU2lnbmF0dXJlIjoiSUNGdExQbnRPS3hINGVwdytCb2FLVnNtRFU0WE1TMXVva3BvYW5OcUwwMytyeXV1bERIdmF2OEJ3VWYvZkdUYzUrOVhGenYzU1BER0k2eWljWGl2Q0E9PSJ9LCJzaWduYWxJZGVudGl0aWVzIjpbeyJpZGVudGlmaWVyIjp7Im5hbWUiOiIyNjM3Nzg4NTgyNDY6MjRAcy53aGF0c2FwcC5uZXQiLCJkZXZpY2VJZCI6MH0sImlkZW50aWZpZXJLZXkiOnsidHlwZSI6IkJ1ZmZlciIsImRhdGEiOiJCYUhQUDBwaVRpQ3g1Yk9obDF2Yk1MR09TeFlTeUZNbUtKdkxnY2pmOC80ZiJ9fV0sInBsYXRmb3JtIjoic21iYSIsImxhc3RBY2NvdW50U3luY1RpbWVzdGFtcCI6MTczNTAzMDIyMywibXlBcHBTdGF0ZUtleUlkIjoiQUFBQUFJemsifQ==
